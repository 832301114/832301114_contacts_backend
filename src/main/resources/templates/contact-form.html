<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${isNew} ? '新建联系人' : '编辑联系人'">联系人表单</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body>
<div class="container mt-4">
    <h2 class="mb-4">
        <i class="bi" th:classappend="${isNew} ? 'bi-person-plus' : 'bi-pencil-square'"></i>
        <span th:text="${isNew} ? '新建联系人' : '编辑联系人'"></span>
    </h2>
    
    <form th:action="@{/contact/save}" method="post">
        <input type="hidden" th:field="*{contact.id}">
        
        <!-- 基本信息 -->
        <div class="card mb-4">
            <div class="card-header">基本信息</div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label">姓名 <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" th:field="*{contact.name}" required>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">公司</label>
                        <input type="text" class="form-control" th:field="*{contact.company}">
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" th:field="*{contact.favorite}" id="favorite">
                            <label class="form-check-label" for="favorite">
                                <i class="bi bi-star-fill text-warning"></i> 收藏此联系人
                            </label>
                        </div>
                    </div>
                </div>
                <div class="mb-3">
                    <label class="form-label">备注</label>
                    <textarea class="form-control" th:field="*{contact.notes}" rows="2"></textarea>
                </div>
            </div>
        </div>
        
        <!-- 联系方式 -->
        <div class="card mb-4">
            <div class="card-header d-flex justify-content-between align-items-center">
                <span>联系方式</span>
                <button type="button" class="btn btn-sm btn-success" onclick="addContactMethod()">
                    <i class="bi bi-plus"></i> 添加
                </button>
            </div>
            <div class="card-body" id="contactMethodsContainer">
                <!-- 已有的联系方式 -->
                <div th:each="method, stat : ${contact.contactMethods}" class="row mb-2 contact-method-row">
                    <div class="col-md-3">
                        <select class="form-select" name="methodTypes">
                            <option th:each="type : ${contactMethodTypes}" 
                                    th:value="${type}" 
                                    th:text="${type.displayName}"
                                    th:selected="${method.type == type}"></option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <input type="text" class="form-control" name="methodValues" th:value="${method.value}" placeholder="值">
                    </div>
                    <div class="col-md-3">
                        <input type="text" class="form-control" name="methodLabels" th:value="${method.label}" placeholder="标签(如:工作)">
                    </div>
                    <div class="col-md-2">
                        <button type="button" class="btn btn-outline-danger" onclick="removeContactMethod(this)">
                            <i class="bi bi-trash"></i>
                        </button>
                    </div>
                </div>
                
                <!-- 新建时默认添加一行 -->
                <div th:if="${isNew}" class="row mb-2 contact-method-row">
                    <div class="col-md-3">
                        <select class="form-select" name="methodTypes">
                            <option th:each="type : ${contactMethodTypes}" th:value="${type}" th:text="${type.displayName}"></option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <input type="text" class="form-control" name="methodValues" placeholder="值">
                    </div>
                    <div class="col-md-3">
                        <input type="text" class="form-control" name="methodLabels" placeholder="标签(如:工作)">
                    </div>
                    <div class="col-md-2">
                        <button type="button" class="btn btn-outline-danger" onclick="removeContactMethod(this)">
                            <i class="bi bi-trash"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="mb-4">
            <button type="submit" class="btn btn-primary">
                <i class="bi bi-check-lg"></i> 保存
            </button>
            <a th:href="@{/}" class="btn btn-secondary">
                <i class="bi bi-x-lg"></i> 取消
            </a>
        </div>
    </form>
</div>

<script th:inline="javascript">
    var contactMethodTypes = [[${contactMethodTypes}]];
    
    function addContactMethod() {
        var container = document.getElementById('contactMethodsContainer');
        var row = document.createElement('div');
        row.className = 'row mb-2 contact-method-row';
        
        var options = '';
        var types = ['PHONE', 'EMAIL', 'ADDRESS', 'WECHAT', 'QQ', 'WEIBO', 'TWITTER', 'FACEBOOK', 'LINKEDIN', 'OTHER'];
        var names = ['电话', '邮箱', '地址', '微信', 'QQ', '微博', 'Twitter', 'Facebook', 'LinkedIn', '其他'];
        for (var i = 0; i < types.length; i++) {
            options += '<option value="' + types[i] + '">' + names[i] + '</option>';
        }
        
        row.innerHTML = `
            <div class="col-md-3">
                <select class="form-select" name="methodTypes">${options}</select>
            </div>
            <div class="col-md-4">
                <input type="text" class="form-control" name="methodValues" placeholder="值">
            </div>
            <div class="col-md-3">
                <input type="text" class="form-control" name="methodLabels" placeholder="标签(如:工作)">
            </div>
            <div class="col-md-2">
                <button type="button" class="btn btn-outline-danger" onclick="removeContactMethod(this)">
                    <i class="bi bi-trash"></i>
                </button>
            </div>
        `;
        container.appendChild(row);
    }
    
    function removeContactMethod(btn) {
        btn.closest('.contact-method-row').remove();
    }
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
